{"version":3,"file":"backbone.deepmodel.js","sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 6881369ed08d3aa6de61","webpack:///lib/index.js","webpack:///external {\"root\":\"Backbone\",\"commonjs2\":\"backbone\",\"commonjs\":\"backbone\",\"amd\":\"backbone\"}","webpack:///lib/object-path.js","webpack:///lib/deep-copy.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"backbone\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"backbone\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"DeepModel\"] = factory(require(\"backbone\"));\n\telse\n\t\troot[\"Backbone\"] = root[\"Backbone\"] || {}, root[\"Backbone\"][\"DeepModel\"] = factory(root[\"Backbone\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_1__) {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 6881369ed08d3aa6de61\n **/","import Backbone from 'backbone'\nimport objectPath from './object-path'\nimport deepCopy from './deep-copy'\n\nconst DEFAULTS = Object.freeze({\n  pathSeparator: '.',\n  pathParser: null\n})\n\nconst _defaults = Object.assign({}, DEFAULTS)\n\nfunction updateObjectPath () {\n  objectPath.pathSeparator = _defaults.pathSeparator\n\n  const pathParser = _defaults.pathParser\n  if (typeof pathParser === 'function' || pathParser == null) {\n    objectPath.pathParser = pathParser\n  }\n\n  return objectPath\n}\n\nfunction isObject (value) {\n  return value != null && typeof value === 'object'\n}\n\n/**\n * @class\n * @see http://backbonejs.org/#Model\n *\n * @example\n * // ES5\n * var Person = DeepModel.extend({...})\n *\n * // ES2015(ES6)\n * class Person extends DeepModel {...}\n */\nexport default class DeepModel extends Backbone.Model {\n\n  /**\n   * this module's version.\n   */\n  static get VERSION () { return '0.3.2' }\n\n  /**\n   * Update default settings.\n   *\n   * @param {Object} [settings={}] reset if `null`\n   * @param {string} [settings.pathSeparator='/']\n   * @param {function(path: string): Array.<string>} [settings.pathParser] ignore if returns `[]`\n   * @returns {Object}\n   *\n   * @example\n   * DeepModel.defaults({anySetting: true})\n   * DeepModel.defaults(null) // reset!\n   *\n   * @example\n   * DeepModel.defaults({pathSeparator: '/'})\n   *\n   * let model = new DeepModel()\n   * model.set('a', {})\n   * model.set('a/b', 1)\n   * model.get('a/b') //=> 1\n   *\n   * @example\n   * DeepModel.defaults({\n   *   pathParser(path) {\n   *     if (path === '*') { return [] } // ignore!\n   *     return path.split('_')\n   *   }\n   * })\n   *\n   * let model = new DeepModel()\n   * model.set('a', {})\n   * model.set('a_b', 1)\n   * model.get('a_b') //=> 1\n   * model.set('*', 2)\n   * model.get('*') //=> undefined\n   */\n  static defaults (settings = {}) {\n    return Object.assign(_defaults, settings == null ? DEFAULTS : settings)\n  }\n\n  /**\n   * @see http://backbonejs.org/#Model-get\n   * @override\n   * @param {string} attribute\n   * @returns {*}\n   *\n   * @example\n   * model.get('a.b')\n   */\n  get (attribute) {\n    return updateObjectPath().get(this.attributes, attribute)\n  }\n\n  /**\n   * @see http://backbonejs.org/#Model-set\n   * @override\n   * @param {string} attribute\n   * @param {*}      value\n   * @param {Object} [options]\n   * @returns {DeepModel}\n   *\n   * @example\n   * model.set({'a.b': 'value'})\n   * model.set('a.b', 'value')\n   */\n  set (attribute, value, options) {\n    if (attribute == null) {\n      return this\n    }\n\n    const _ = updateObjectPath()\n\n    let attrs\n    if (typeof attribute === 'object') {\n      attrs = attribute\n      options = value\n    } else {\n      if (!_.pathParser && !_.hasSeparator(attribute)) {\n        return super.set(attribute, value, options)\n      }\n      attrs = {}\n      attrs[attribute] = value\n    }\n\n    const newAttrs = Object.keys(attrs).reduce((newObj, path) => {\n      const paths = _.parse(path)\n\n      if (paths.length === 0) {\n        return newObj\n      }\n      if (paths.length === 1) {\n        newObj[paths[0]] = attrs[path]\n        return newObj\n      }\n\n      const rootPath = paths[0]\n      let obj = newObj[rootPath]\n      if (obj == null) {\n        obj = deepCopy(this.attributes[rootPath])\n      }\n      if (!isObject(obj)) {\n        throw new Error(`\"${path}\" does not exist in ${JSON.stringify(this)}`)\n      }\n      newObj[rootPath] = obj\n\n      return _.set(newObj, paths, attrs[path])\n    }, {})\n\n    return super.set(newAttrs, options)\n  }\n\n}\n\nDeepModel.extend = Backbone.Model.extend\n\n\n\n/** WEBPACK FOOTER **\n ** lib/index.js\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external {\"root\":\"Backbone\",\"commonjs2\":\"backbone\",\"commonjs\":\"backbone\",\"amd\":\"backbone\"}\n ** module id = 1\n ** module chunks = 0\n **/","function ARRAY_PATTERN () {\n  return /\\[(\\w+)\\]/g\n}\n\nfunction isArrayIndex (value) {\n  const num = Number(value)\n  return num >= 0 && num % 1 === 0\n}\n\nexport default {\n  pathSeparator: '.',\n\n  /**\n   * @param {?string} s\n   * @returns {boolean}\n   */\n  hasSeparator (s) {\n    return typeof s === 'string' &&\n    (s.indexOf(this.pathSeparator) >= 0 || ARRAY_PATTERN().test(s))\n  },\n\n  /**\n   * @param {string | string[]} path\n   * @returns {string[]}\n   *\n   * @example\n   * parse('a.b')      //=> ['a', 'b']\n   * parse('a[0]')     //=> ['a', '0']\n   * parse(['a', 'b']) //=> ['a', 'b']\n   */\n  parse (path) {\n    if (Array.isArray(path)) {\n      return path\n    }\n    if (typeof this.pathParser === 'function') {\n      return this.pathParser(path)\n    }\n    if (!this.hasSeparator(path)) {\n      return [path]\n    }\n    const sep = this.pathSeparator\n    return path.replace(ARRAY_PATTERN(), sep + '$1').split(sep)\n  },\n\n  /**\n   * @param {Object} obj\n   * @param {string | string[]} path\n   * @returns {?*}\n   */\n  get (obj, path) {\n    const pathElements = this.parse(path)\n    if (pathElements.length === 0) {\n      return\n    }\n\n    // TODO: Because of \"Symbol is not defined\", cannot use `for..of`\n    let value = obj\n    for (let i = 0, len = pathElements.length; i < len; i++) {\n      const pathElement = pathElements[i]\n      if (pathElement in value) {\n        value = value[pathElement]\n      } else {\n        return\n      }\n    }\n    return value\n  },\n\n  /**\n   * @param {Object} obj\n   * @param {string | string[]} path\n   * @param {*} value\n   * @returns {Object} given `obj`\n   */\n  set (obj, path, value) {\n    const pathElements = this.parse(path)\n    const lastIndex = pathElements.length - 1\n    pathElements.reduce((current, pathElement, index) => {\n      if (index < lastIndex) {\n        if (pathElement in current) {\n          current = current[pathElement]\n        } else {\n          const newObj = isArrayIndex(pathElements[index + 1]) ? [] : {}\n          current = current[pathElement] = newObj\n        }\n      } else {\n        current[pathElement] = value\n      }\n      return current\n    }, obj)\n    return obj\n  }\n\n}\n\n\n\n/** WEBPACK FOOTER **\n ** lib/object-path.js\n **/","/**\n * @private\n * @param {Object|Array} [source]\n * @returns {Object|Array}\n */\nexport default function deepCopy (source) {\n  if (typeof source !== 'object' || source == null) {\n    return source\n  }\n\n  let initial = Array.isArray(source) ? [] : {}\n  return Object.keys(source).reduce((copy, key) => {\n    copy[key] = deepCopy(source[key])\n    return copy\n  }, initial)\n}\n\n\n\n/** WEBPACK FOOTER **\n ** lib/deep-copy.js\n **/"],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;ACtCA;AACA;;;AAAA;AACA;;;AAAA;AACA;;;;;;;;;;;AACA;AACA;AACA;AAFA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AAWA;;;;;;;;;;;;;AA8CA;;;;;;;;;AASA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;AAYA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AA5GA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA;AAAA;AACA;AAAA;AACA;;;;;AA1CA;;;AAGA;AAAA;AAAA;;;;AALA;AACA;AADA;AACA;AACA;AAqHA;;;;;;;AC5JA;;;;;;;;;;;ACAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AAEA;AACA;AACA;AAAA;;;;;;;;;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlFA;;;;;;;;;;;;;;;ACJA;AALA;;;;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;","sourceRoot":""}