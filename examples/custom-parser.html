<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Backbone.DeepModel customize parser example</title>
    <link href="./style.css" rel="stylesheet">
  </head>
  <body>
    <div class="output"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.2.3/backbone-min.js"></script>
    <script src="../dist/backbone.deepmodel.js"></script>
    <script src="./util.js"></script>
    <script>
      Backbone.DeepModel.defaults({
        // JSON Pointer parser (https://tools.ietf.org/html/rfc6901)
        pathParser: function (path) {
          if (path.indexOf('/') === -1) {
            return [path]
          }
          if (path.charAt(0) !== '/') {
            throw new Error('Invalid JSON pointer: ' + path)
          }
          return path.substring(1).split('/').map(function (str) {
            return str.replace(/~1/g, '/').replace(/~0/g, '~')
          })
        }
      })

      var model = new Backbone.DeepModel()
      model.set({
        '/foo':  ['bar', 'baz'],
        '/':     0,
        '/a~1b': 1,
        '/c%d':  2,
        '/e^f':  3,
        '/g|h':  4,
        '/i\\j': 5,
        '/k\"l': 6,
        '/ ':    7,
        '/m~0n': 8
      })
      console.log(model.toJSON())
    </script>
  </body>
</html>
